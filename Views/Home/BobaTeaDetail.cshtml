@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@model CappyPop_Full_HTML.Models.HomeViewModel.ViewBoBaTea;

<main>
    <section class="product-detail section">
        <div class="container">
            <div class="row">
                <div class="col-lg-5">
                    <div class="product-left">
                        <img id="main-image" src="@Model.SelectedBobaTea.PrimaryImageUrl" alt="boba">
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="product-right">
                        <div class="product-info">

                            <div class="info-detail">
                                <input type="hidden" id="bobaid" asp-for="SelectedBobaTea.BobaId"
                                    value="@Model.SelectedBobaTea.BobaId" />
                                <p>@Model.SelectedBobaTea.BobaDescription</p>
                                <h2 id="bobaname">@Model.SelectedBobaTea.BobaName</h2>
                                <h3 id="total-price">@Model.SelectedBobaTea.Price đ</h3>
                                <h4><i class="icofont-delivery-time"></i>Fast Delivery<i
                                        class="icofont-ui-timer"></i>Best taste within 20 mins</h4>
                            </div>

                            <div class="product-select">
                                <div class="row">
                                    <div class="col-lg-4">
                                        <div class="single-select">
                                            <h5>Ice:</h5>
                                            <select class="nice-select cart-form-select">
                                                @foreach (var iceLevel in Model.SelectedIceLevels)
                                                {
                                                    <option value="@iceLevel">@iceLevel</option>
                                                }
                                            </select>


                                        </div>
                                    </div>


                                    <div class="col-lg-6">
                                        <div class="single-select">
                                            <h5>Sugar:</h5>
                                            <select class="nice-select cart-form-select">
                                                @foreach (var sugarLevel in Model.SelectedSugarLevels)
                                                {
                                                    <option value="@sugarLevel">@sugarLevel</option>
                                                }
                                            </select>
                                        </div>
                                    </div>

                                    <div class="col-lg-4">
                                        <div class="single-select">
                                            <h5>Size:</h5>
                                            <select class="nice-select cart-form-select" id="size-select">
                                                @foreach (var size in Model.SelectedSizeNames)
                                                {
                                                    <option value="@size">@size</option>
                                                }
                                            </select>
                                        </div>
                                    </div>

                                    <div class="col-lg-12">
                                        <div class="single-select">
                                            <h5>Topping:</h5>
                                            <select class="nice-select cart-form-select" id="topping-select"
                                                onchange="updatePrice()">
                                                @foreach (var topping in Model.SelectedToppingNames)
                                                {
                                                    <option value="@topping"
                                                        data-price="@Model.SelectedToppingPrices[topping]">
                                                        @topping (+@Model.SelectedToppingPrices[topping]đ)
                                                    </option>
                                                }

                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-lg-9">
                                        <div class="single-select">
                                            <h5>Quantity:</h5>

                                            <button class="btn px-2"
                                                onclick="this.parentNode.querySelector('input[type=number]').stepDown()">
                                                <i class="icofont-minus"></i>
                                            </button>

                                            <input min="1" name="quantity" value="1" type="number"
                                                class="nice-select cart-form-select" style="width: 120px;" />

                                            <button class="btn px-2"
                                                onclick="this.parentNode.querySelector('input[type=number]').stepUp()">
                                                <i class="icofont-plus" style="width: 10px;"></i>
                                            </button>

                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="button">
                                <a href="/home/usermycart" id="addcart" class="btn">Add to Cart</a>
                            </div>

                        </div>
                    </div>
                </div>


            </div>

        </div>

        </div>

    </section>

    <!--/ End Boba Detail Page -->

    <!-- Start Fun-facts -->
    <div id="fun-facts" class="fun-facts section" style="background-color: var(--primary-bg-color);">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-title">
                        <h2>How does it work</h2>
                        <img src="/img/favicon.png" alt="#" width="50" height="50">
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-12">
                    <!-- Start Single Fun -->
                    <div class="single-fun">
                        <img src="/img/Icons.png" alt="logo" width="125" height="170">
                        <div class="content">
                            <span>Place your order</span>
                            <p>Check over hundreds of menus to pick your favorite drinks</p>
                        </div>
                    </div>
                    <!-- End Single Fun -->
                </div>
                <div class="col-lg-3 col-md-6 col-12">
                    <!-- Start Single Fun -->
                    <div class="single-fun">
                        <img src="/img/Icons-1.png" alt="logo" width="125" height="170">
                        <div class="content">
                            <span>Select location</span>
                            <p>Choose the location where your drinks will be delivered</p>
                        </div>
                    </div>
                    <!-- End Single Fun -->
                </div>
                <div class="col-lg-3 col-md-6 col-12">
                    <!-- Start Single Fun -->
                    <div class="single-fun">
                        <img src="/img/Icons-2.png" alt="logo" width="125" height="170">
                        <div class="content">
                            <span>Pay advanced</span>
                            <p>It's quick, safe, and simple. Select several methods of payment</p>
                        </div>
                    </div>
                    <!-- End Single Fun -->
                </div>
                <div class="col-lg-3 col-md-6 col-12">
                    <!-- Start Single Fun -->
                    <div class="single-fun">
                        <img src="/img/Icons-3.png" alt="logo" width="125" height="170">
                        <div class="content">
                            <span>Enjoy</span>
                            <p>Bobas are made and delivered directly to your home.</p>
                        </div>
                    </div>
                    <!-- End Single Fun -->
                </div>
            </div>
        </div>
    </div>
    <!--/ End Fun-facts -->

    <!-- Card Boba -->
    <section class="section-products">
        <div class="container">
            <div class="row justify-content-center text-center">
                <div class="col-md-8 col-lg-10">
                    <div class="header">

                        <h2>You May Also Like</h2>
                    </div>
                </div>
            </div>
            <div class="row">
                <!-- Single Product -->
                <div class="col-md-6 col-lg-4 col-xl-3">
                    <div class="single-product">

                        <div class="part-1">

                            <img src="/img/boba-img/boba.png" class="product-img">

                            <ul>
                                <li><a href="view-detail-boba.html"><i class="icofont-cart"></i></a></li>

                            </ul>
                        </div>
                        <div class="part-2">
                            <h3 class="product-title">Mint Boba</h3>
                            <h4 class="product-price">38.000đ</h4>
                        </div>
                    </div>
                </div>
                <!-- Single Product -->
                <div class="col-md-6 col-lg-4 col-xl-3">
                    <div class="single-product">
                        <div class="part-1">

                            <img src="/img/boba-img/boba-3.png" class="product-img">

                            <ul>
                                <li><a href="view-detail-boba.html"><i class="icofont-cart"></i></a></li>

                            </ul>
                        </div>
                        <div class="part-2">
                            <h3 class="product-title">Pink Machitto Black Pearl</h3>
                            <h4 class="product-price">38.000đ</h4>
                        </div>
                    </div>
                </div>
                <!-- Single Product -->
                <div class="col-md-6 col-lg-4 col-xl-3">
                    <div class="single-product">
                        <div class="part-1">

                            <img src="/img/boba-img/boba-4.png" class="product-img">
                            <ul>
                                <li><a href="view-detail-boba.html"><i class="icofont-cart"></i></a></li>

                            </ul>
                        </div>
                        <div class="part-2">
                            <h3 class="product-title">Orange Favour Milk Boba</h3>

                            <h4 class="product-price">38.000đ</h4>
                        </div>
                    </div>
                </div>
                <!-- Single Product -->
                <div class="col-md-6 col-lg-4 col-xl-3">
                    <div class="single-product">
                        <div class="part-1">

                            <img src="/img/boba-img/boba-2.png" class="product-img">

                            <ul>
                                <li><a href="view-detail-boba.html"><i class="icofont-cart"></i></a></li>

                            </ul>
                        </div>
                        <div class="part-2">
                            <h3 class="product-title">Brow Chocolate Sugar</h3>
                            <h4 class="product-price">38.000đ</h4>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </section>
    <!-- End Card Boba -->
</main>
<script>
    function updatePrice() {
        // Giá cơ bản
        let basePrice = parseFloat("@Model.SelectedBobaTea.Price");

        // Lấy giá topping
        let toppingSelect = document.getElementById("topping-select");
        let selectedOption = toppingSelect.options[toppingSelect.selectedIndex];
        let toppingPrice = parseFloat(selectedOption.getAttribute("data-price")) || 0;

        // Tính tổng giá
        let totalPrice = basePrice + toppingPrice;
        totalPrice = Math.round(totalPrice); // Làm tròn giá trị nếu cần

        // Làm tròn tổng giá cho tiền tệ (VND)
        totalPrice = Math.round(totalPrice);

        // Hiển thị giá mới
        document.getElementById("total-price").innerText = totalPrice.toLocaleString() + " đ";
    }

</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        updatePrice();
    });
</script>
<script>
    function addToCart(item) {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        // Kiểm tra xem sản phẩm đã tồn tại trong giỏ hàng hay chưa
        const existingIndex = cart.findIndex(cartItem => cartItem.id === item.id);

        if (existingIndex !== -1) {
            Swal.fire({
                icon: 'info',
                title: 'Thông báo',
                text: 'Sản phẩm này đã có trong giỏ hàng!',
            });
        } else {
            cart.push(item);
            localStorage.setItem('cart', JSON.stringify(cart));
            Swal.fire({
                icon: 'success',
                title: 'Thành công',
                text: 'Sản phẩm đã được thêm vào giỏ hàng!',
            });
        }
    }

    // Thêm sự kiện cho nút "Add to Cart"
    document.getElementById('addcart').addEventListener('click', () => {
        // Lấy giá trị từ DOM
        const id = document.getElementById('bobaid').value;
        const name = document.getElementById('bobaname').textContent;
        const size = document.getElementById('size-select').value;
        const topping = document.getElementById('topping-select').value;

        // Lấy và xử lý giá
        const priceText = document.getElementById('total-price').textContent;
        const price = parseFloat(priceText.replace(' đ', '').replace(/\./g, '').replace(',', '.'));


        const quantityInput = document.querySelector('input[name="quantity"]');
        const quantity = parseInt(quantityInput.value) || 1; // Giá trị mặc định là 1 nếu không nhập
        const imageUrl = document.getElementById('main-image').getAttribute('src');

        // Tạo đối tượng sản phẩm
        const item = {
            id: id,
            name: name,
            size: size,
            topping: topping,
            price: price, // Giá đúng là một số
            quantity: quantity,
            image: imageUrl,
        };

        // Thêm vào giỏ hàng
        addToCart(item);
    });



</script>